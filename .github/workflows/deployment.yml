name: Build Maven project and deploy to lmabda
  on: [push]
  jobs:
    compile:
      runs-on: ubuntu-20.04
      strategy:
        matrix:
          java: [11]
      name: Java ${{ matrix.java }} compile
      steps:
        - name: Checkout source code
          uses: actions/checkout@v2
        - name: Setup java
          uses: actions/setup-java@v2
          with:
            distribution: 'adopt'
              java-package: jdk
              java-version: ${{ matrix.java }}
        - name: Compile the project
          working-directory: github-actions-java-maven
          run: mvn -B compile
    build:
      runs-on: ubuntu-20.04
      needs: compile
      name: Build the package
      steps:
        - uses: actions/checkout@v2
        - uses: actions/cache@v2
          with:
            path: ~/.m2/repository
            key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}
            restore-keys: |
              ${{ runner.os }}-maven-
        - name: Setup jdk 11
          uses: actions/setup-java@v2
          with:
            distribution: 'adopt'
            java-version: 11
            java-package: jdk
        - name: Build and test project
          working-directory: github-actions-java-maven
          run: mvn clean package --file pom.xml



